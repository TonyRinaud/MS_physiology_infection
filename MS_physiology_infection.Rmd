---
title: "Manuscript_physiological_consequences_blood_parasite_infection"
author: "Tony Rinaud"
date: "`r Sys.Date()`"
output: pdf_document
---

# Analysis of blood parasite infection effect on physiological change of common buzzard nestlings:

  Data from common buzzard's (*Buteo buteo*) nestling of the years 2016, 2018, 2019 and 2020 which have been sampled twice during their nesting phase. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Required packages

```{r packages, message=F, warning=F}
library(easypackages)
libraries('plotly','ggplot2','Hmisc','ggalt','plyr','chron','dplyr','stringr','tidyr','FSA','grid','gridExtra','ggsci','lme4','RVAideMemoire','lsmeans','MuMIn','EnvStats','devtools','RColorBrewer','tidyverse','brms','tidybayes','patchwork','pdftools','osmdata','rgdal','magrittr','purrr','forcats','modelr','ggstance','ggridges','cowplot','ggrepel','gganimate','ggridges','rptR','rdwd','sjPlot','sjlabelled','sjmisc','wesanderson', "ggpubr","ggsignif",'ggdist','ggeffect')

# Routine clean-up upon start
rm(list=ls())

theme_set(theme_tidybayes() + panel_border())

```

```{r data, echo=F}

## Data source

data2016_2020=read.csv('./physiology_infection_stage_full_wideformat.csv', h=T, sep=';', dec=".")

### Setting classes of variables

data2016_2020$Nest=as.factor(data2016_2020$Nest)
data2016_2020$Date=chron(as.character(data2016_2020$Date), format="d/m/y")
data2016_2020$Infection_intensity=as.factor(data2016_2020$Infection_intensity)
data2016_2020$Prevalence=as.factor(data2016_2020$Prevalence)
data2016_2020$Breathing_rate=as.numeric(data2016_2020$Breathing_rate)
data2016_2020$Sex=as.factor(data2016_2020$Sex)
data2016_2020$Sampling_rank=as.factor(data2016_2020$Sampling_rank)
data2016_2020$Weight_g=scale(as.numeric(data2016_2020$Weight.2))
data2016_2020$Wing_cm=as.numeric(data2016_2020$Wing)
data2016_2020$body_temperature=as.numeric(data2016_2020$body_temperature)
data2016_2020$delta_body_condition=as.numeric(data2016_2020$delta_body_condition)
data2016_2020$Ambient_Temperature_AvgC=scale(as.numeric(data2016_2020$TemperatureAvgC))
data2016_2020$Treatment=as.factor(data2016_2020$Treatment)
data2016_2020$Year=as.factor(data2016_2020$Year)
data2016_2020$Growth_rate=as.numeric(data2016_2020$Growth_rate_unlog)
data2016_2020$days_resample=scale(data2016_2020$days_resample)
data2016_2020$Age_in_days=scale(as.numeric(data2016_2020$Age_in_days))

data2016_2020$Diff_Inf_Class=factor(data2016_2020$Diff_Inf_Class, levels=c("Uninfected","Increase","Peak","Decrease"))
data2016_2020=arrange(data2016_2020,data2016_2020$Diff_Inf_Class)

# Filtering non-applicable infection change

data2016_2020=data2016_2020[!is.na(data2016_2020$Diff_Inf_Class),]

```

**Analyses**

## Testing for effectiveness of treatment

```{r}

# Contingency table of control versus treated but uninfected nestlings at the two samplings

tab.cont_noinfect=matrix(c(length(data2016_2020$Infection_intensity.1[data2016_2020$Infection_intensity.1 %in% 0 & data2016_2020$Treatment %in% "Control"]),length(data2016_2020$Infection_intensity.1[data2016_2020$Infection_intensity.1 %in% 0 & data2016_2020$Treatment %in% "Malarone"]),length(data2016_2020$Prevalence[data2016_2020$Prevalence %in% 0 & data2016_2020$Treatment %in% "Control" & data2016_2020$Sampling_rank %in% 2]),length(data2016_2020$Prevalence[data2016_2020$Prevalence %in% 0 & data2016_2020$Treatment %in% "Malarone" & data2016_2020$Sampling_rank %in% 2])),nrow = 2,ncol = 2,dimnames = list(c("Control","Malarone"),c("Before","After")))

# Testing whether proportions of uninfected nestlings at first and second samplings differs between treatments

tab.cont_noinfect=t(tab.cont_noinfect)

prop.test(tab.cont_noinfect)

pairwise.prop.test(tab.cont_noinfect)

# Contingency table of control versus treated but infected at the two samplings

tab.cont_infected=matrix(c(length(data2016_2020$Infection_intensity.1[data2016_2020$Infection_intensity.1 %in% c(1,2,3,4) & data2016_2020$Treatment %in% "Control"]),length(data2016_2020$Infection_intensity.1[data2016_2020$Infection_intensity.1 %in% c(1,2,3,4) & data2016_2020$Treatment %in% "Malarone"]),length(data2016_2020$Prevalence[data2016_2020$Prevalence %in% 1 & data2016_2020$Treatment %in% "Control"]),length(data2016_2020$Prevalence[data2016_2020$Prevalence %in% 1 & data2016_2020$Treatment %in% "Malarone"])), nrow = 2, ncol = 2, dimnames = list(c("Control","Malarone"),c("Pre","Post")))

# Testing whether proportions of infected nestlings at first and second samplings differs between treatments

tab.cont_infected=t(tab.cont_infected)

prop.test(tab.cont_infected)

pairwise.prop.test(tab.cont_infected)

## Plotting count of infected / uninfected nestlings across treatments

tab_cont=data.frame(Timepoint=c("Pre-treatment","Post-treatment","Pre-treatment","Post-treatment","Pre-treatment","Post-treatment","Pre-treatment","Post-treatment"),Count=c(tab.cont_noinfect[1,1],tab.cont_noinfect[2,1],tab.cont_noinfect[1,2],tab.cont_noinfect[2,2],tab.cont_infected[1,1],tab.cont_infected[2,1],tab.cont_infected[1,2],tab.cont_infected[2,2]),Treatment=c("Control","Control","Malarone","Malarone","Control","Control","Malarone","Malarone"),Prevalence=c("Uninfected","Uninfected","Uninfected","Uninfected","Infected","Infected","Infected","Infected"))

tab_cont$Timepoint=factor(tab_cont$Timepoint,levels = c("Pre-treatment","Post-treatment"))
tab_cont$Prevalence=factor(tab_cont$Prevalence,levels = c("Uninfected","Infected"))

# Figure 2a

treatment_prevalence_changes=ggplot(tab_cont)+
  aes(Timepoint,Count,fill=Prevalence)+
  facet_wrap(facets = "Treatment")+
  geom_bar(stat = 'identity',  width = 0.3)+
  labs(y="Count of nestlings")+
  geom_text(aes(label=Count),position = position_stack(0.5))+
  scale_fill_manual(values=c("#D0D0D0","#A8A8A8"))+
  theme(axis.title.x = element_blank(), strip.text = element_text(size=16, face="bold"),legend.text = element_text(size=14), legend.title = element_text(size=16),axis.title.y=element_text(size=18, margin= unit(c(0, 3, 0, 0), "mm")),  axis.text=element_text(size=16))

## Plotting mean infection intensity values of nestlings across treatments

mean_infint=data.frame(Sampling_rank=factor(c(rep("1",length(data2016_2020$Sampling_rank)),as.character(data2016_2020$Sampling_rank)),levels=c("1","2"), labels = c("Pre-treatment","Post-treatment")),Infection_intensity=as.numeric(c(as.character(data2016_2020$Infection_intensity.1),as.character(data2016_2020$Infection_intensity))),Treatment=factor(c(as.character(rep(data2016_2020$Treatment,2))),levels = c("Control","Malarone")))

# Figure 2b

treatment_meaninf_changes=ggplot(mean_infint)+
  aes(Sampling_rank,Infection_intensity, group=Treatment)+
  geom_vline(xintercept = "Pre-treatment", linetype = "dashed", color='darkgrey')+
  geom_vline(xintercept = "Post-treatment", linetype = "dashed", color='darkgrey')+
  labs(y="Mean infection intensity")+
  geom_point(aes(colour=Treatment),position=position_jitterdodge(jitter.height = 0.1))+  #jitter.width = 0.2, jitter.height = 0.5) position=position_jitterdodge()
  # geom_line(aes(group=Treatment,color=Treatment, fill=Treatment),size=2)+
  stat_summary(fun=mean, geom="line",size=2,color=c("lightgrey","black","black","lightgrey"))+
  stat_summary(fun=mean, geom="point",size=5)+
  stat_summary(fun.data=mean_se, geom="errorbar", width=0.04, size=2)+
  scale_color_manual(values=c("lightgrey","black"))+
  theme_classic()+
  theme(axis.title.x = element_blank(), legend.text = element_text(size=16), legend.title = element_text(size=16), axis.title.y=element_text(size=18, margin= unit(c(0, 3, 0, 0), "mm")),  axis.text=element_text(size=16), plot.margin = unit(c(0,0,0,30), "pt"))

# Panel wrapping Fig2 a & b:

Fig2=treatment_prevalence_changes+treatment_meaninf_changes+ plot_annotation(tag_levels = 'A')& 
  theme(plot.tag = element_text(size = 16, face = "bold"))

ggsave(Fig2,filename = "./Figs/efficiency_malarone.png",units = "px", width = 6000, height = 3000)

# Testing for difference in mean infection intensity between Pre and Post treatment

mean_before_after=data.frame(Ring_no=c(data2016_2020$Ring_no[data2016_2020$Sampling_rank %in% 2], data2016_2020$Ring_no[data2016_2020$Sampling_rank %in% 2]), Infection_intensity=c(as.character(data2016_2020$Infection_intensity.1), as.character(data2016_2020$Infection_intensity)),Treatment=c(as.character(data2016_2020$Treatment[data2016_2020$Sampling_rank %in% 2]), as.character(data2016_2020$Treatment[data2016_2020$Sampling_rank %in% 2])),Timepoint=c(rep("Pre-treatment",times=length(data2016_2020$Treatment)),rep("Post-treatment",times=length(data2016_2020$Infection_intensity))))

mean_before_after$Treatment=as.factor(mean_before_after$Treatment)
mean_before_after$Timepoint=as.factor(mean_before_after$Timepoint)

mal=mean_before_after[mean_before_after$Treatment %in% "Malarone",]
ctrl=mean_before_after[mean_before_after$Treatment %in% "Control",]

first=mean_before_after[mean_before_after$Timepoint %in% "Pre-treatment",]

## Pre-treatment difference in parasitic load between Treatments

perm.t.test(as.numeric(as.character(first$Infection_intensity))~first$Treatment)

sd(first$Infection_intensity[first$Treatment %in% "Control"])

## In malarone treated nestlings

perm.t.test(as.numeric(as.character(mal$Infection_intensity))~mal$Timepoint)

# In control nestlings

perm.t.test(as.numeric(as.character(ctrl$Infection_intensity))~ctrl$Timepoint)

```

## Testing the effect of antimalarial treatment on the four physiological parameters in nestlings

### Breathing rate

```{r}

# Model 
# No effect of treatment on the breathing rate of nestlings

lm_d1=lm(Breathing_rate~Treatment, data=data2016_2020)
```

### Body temperature

```{r}

# Model 
# No effect of treatment on the body temperature of nestlings

lm_d2=lm(body_temperature~Treatment, data=data2016_2020)
```

### Body condition change

```{r}

# Model 
# No effect of treatment on the body condition change of nestlings

lm_d3=lm(delta_body_condition~Treatment, data=data2016_2020)
```

### Growth rate

```{r}

# Model 
# No effect of the antimalarial treatment on the growth rate 

lm_d4=lm(Growth_rate~Treatment, data=data2016_2020)

# Table S1

tab_model(lm_d1,lm_d2,lm_d3,lm_d4,
          show.reflvl = T,
          show.ci50 = T ,
          show.stat = T,
          string.stat = "t",
          pred.labels = c("Intercept","Treatment [Malarone]"),
          dv.labels = c("Breathing rate","Body temperature", "Δ Body condition","Growth rate"),
          file = "./table_results/Physiological_parameters_in_decreasing_control_treated.html")
```


# Infection stages as explanatory variable 

## Breathing rate

```{r mixed model breathing rate, warning=F, message=F, echo=F}

# Model 

lmer_br=lmer(data= data2016_2020, Breathing_rate~Diff_Inf_Class+Diff_Inf_Class:Treatment+days_resample+Age_in_days+Weight_g+Sex+Ambient_Temperature_AvgC+Year+(1|Nest))

# Predicted values for each infection stage

mod_br=get_model_data(lmer_br,type='pred',terms="Diff_Inf_Class") %>% 
   mutate(x=factor(c("Uninfected","Increase","Peak","Decrease"), levels=c("Uninfected","Increase","Peak","Decrease")))

# Table with sample sizes specific for breathing rate data

n=table(data2016_2020$Diff_Inf_Class[!is.na(data2016_2020$Breathing_rate)])

mod_br <- mod_br %>% 
  mutate(x = factor(c(paste0(x,"\nn=",n)), levels=c(paste0(x,"\nn=",n))))

# Plotting predicted values across infection stages

gg1_pred=ggplot(mod_br)+
  aes(x,predicted)+
  geom_hline(yintercept = mean(mod_br$predicted, na.rm=T), linetype = "dashed")+
  labs(x="", y="Breathing rate")+
  ylim(c(min(mod_br$conf.low)-1.5,max(mod_br$conf.high)+1.5))+
  geom_errorbar(aes(ymin=mod_br$conf.low,ymax=mod_br$conf.high),colour="black",size=2, width=.1)+
  geom_errorbar(aes(ymin=mod_br$predicted-mod_br$std.error,ymax=mod_br$predicted+mod_br$std.error),size=8, colour=wes_palette("Zissou1",4), width=0,)+
  geom_point(color ="black", outlier.shape = NA, size=2, width=.3)+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))+
  geom_segment(size = .8,
  aes(x=1, y=max(mod_br$conf.high)+1, xend=4, yend=max(mod_br$conf.high)+1))+
  geom_text(aes(x=2.5, y=max(mod_br$conf.high)+1.5),
  label="n.s.", size = 5)
```

## Body temperature

```{r mixed model body temp after, warning=FALSE, message=F, echo=F}

# Model 

lmer_bt=lmer(data = data2016_2020,body_temperature~Diff_Inf_Class+Diff_Inf_Class:Treatment+Ambient_Temperature_AvgC+days_resample+Age_in_days+Weight_g+Sex+Year+(1|Nest))

# Predicted values for each infection stage

mod_bt=get_model_data(lmer_bt,type='pred',terms="Diff_Inf_Class") %>%
  mutate(x=factor(c("Uninfected","Increase","Peak","Decrease"), levels=c("Uninfected","Increase","Peak","Decrease")))

# Table with sample sizes specific for body temperature data

n2=table(data2016_2020$Diff_Inf_Class[!is.na(data2016_2020$body_temperature)])

mod_bt <- mod_bt %>% 
  mutate(x = factor(c(paste0(x,"\nn=",n2)), levels=c(paste0(x,"\nn=",n2))))

# Plotting predicted values across infection stages

gg2_pred=ggplot(mod_bt)+
  aes(x,predicted)+
  geom_hline(yintercept = mean(mod_bt$predicted, na.rm=T), linetype = "dashed")+
  labs(x="", y="Body temperature")+
  geom_errorbar(aes(ymin=mod_bt$conf.low,ymax=mod_bt$conf.high),colour="black",size=2, width=.1)+
  geom_errorbar(aes(ymin=mod_bt$predicted-mod_bt$std.error,ymax=mod_bt$predicted+mod_bt$std.error),size=8,colour=wes_palette("Zissou1",4), width=0)+
  geom_point(color ="black", outlier.shape = NA, size=2, width=.3)+
  theme_classic()+
  theme(legend.position="none", axis.title.y=element_text(size=14, margin=unit(c(0,3,0,0),"mm")),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))+
  geom_segment(size = .8,
                 aes(x=1, y=40.6, xend=4, yend=40.6))+
    geom_text(aes(x=2.5, y=40.7),
              label="n.s.", size = 5)

```

## Body condition change

```{r mixed model body condition, warning=FALSE, message=F, echo=F}

# Model 

lmer_bc=lmer(data= data2016_2020,delta_body_condition~Diff_Inf_Class+Diff_Inf_Class:Treatment+days_resample+Age_in_days+Sex+Year+(1|Nest))

# Predicted values for each infection stage

mod_bc=get_model_data(lmer_bc,type='pred',terms="Diff_Inf_Class") %>%
  mutate(x=factor(c("Uninfected","Increase","Peak","Decrease"), levels=c("Uninfected","Increase","Peak","Decrease")))

# Table with sample sizes specific for body condition change data

n3=table(data2016_2020$Diff_Inf_Class[!is.na(data2016_2020$delta_body_condition)])

mod_bc <- mod_bc %>% 
  mutate(x = factor(c(paste0(x,"\nn=",n3)), levels=c(paste0(x,"\nn=",n3))))

# Plotting predicted values across infection stages

gg3_pred=ggplot(mod_bc)+
  aes(x,predicted)+
  geom_hline(yintercept = mean(mod_bc$predicted, na.rm=T), linetype = "dashed")+
  labs(x="", y="Δ Body condition")+
  geom_errorbar(aes(ymin=mod_bc$conf.low,ymax=mod_bc$conf.high),colour="black",size=2, width=.1)+
  geom_errorbar(aes(ymin=mod_bc$predicted-mod_bc$std.error,ymax=mod_bc$predicted+mod_bc$std.error),size=8,colour=wes_palette("Zissou1",4), width=0,)+
  geom_point(color ="black", outlier.shape = NA, size=2, width=.3)+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))+
  geom_segment(size = .8,
                 aes(x=1, y=max(mod_bc$conf.high)+17, xend=4, yend=max(mod_bc$conf.high)+17))+
    geom_text(aes(x=2.5, y=max(mod_bc$conf.high)+23),
              label="n.s.", size = 5)

```

## Growth rate

```{r mixed model body temp, warning=FALSE, message=F, echo=F}

# Model 

lmer_gr=lmer(data=data2016_2020,Growth_rate~Diff_Inf_Class+Diff_Inf_Class:Treatment+Sex+days_resample+Age_in_days+Year+(1|Nest))

# Predicted values for each infection stages

mod_gr=get_model_data(lmer_gr,type='pred',terms="Diff_Inf_Class")%>%
  mutate(x=factor(c("Uninfected","Increase","Peak","Decrease"), levels=c("Uninfected","Increase","Peak","Decrease")))

# Table with sample sizes specific for growth rate data

n4=table(data2016_2020$Diff_Inf_Class[!is.na(data2016_2020$Growth_rate)])

mod_gr <- mod_gr %>% 
  mutate(x = factor(c(paste0(x,"\nn=",n4)), levels=c(paste0(x,"\nn=",n4))))

# Plotting predicted values across infection stages

gg4_pred=ggplot(mod_gr)+
  aes(x,predicted)+
  geom_hline(yintercept = mean(mod_gr$predicted, na.rm=T), linetype = "dashed")+
  labs(x="", y="Growth rate")+
  geom_errorbar(aes(ymin=mod_gr$conf.low,ymax=mod_gr$conf.high),colour="black",size=2, width=.1)+
  geom_errorbar(aes(ymin=mod_gr$predicted-mod_gr$std.error,ymax=mod_gr$predicted+mod_gr$std.error),size=8,colour=wes_palette("Zissou1",4), width=0,)+
  geom_point(color ="black", outlier.shape = NA, size=2, width=.3)+
  theme_classic()+
  theme(legend.position="none", axis.title.y=element_text(size=14,margin= unit(c(0, 3, 0, 0), "mm")),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 30, "pt"), plot.title = element_text(hjust = 0.5, face="bold"))+
  geom_segment(size = .8,
                 aes(x=1, y=max(mod_gr$conf.high)+1.2, xend=4, yend=max(mod_gr$conf.high)+1.2))+
    geom_text(aes(x=2.5, y=max(mod_gr$conf.high)+2),
              label="n.s.", size = 5)

```

# Summary four models

```{r, summary}

# Figure 4 

fig4=gg1_pred+gg2_pred+gg3_pred+gg4_pred + plot_annotation(tag_levels = 'A')& 
  theme(plot.tag = element_text(size = 16, face = "bold"))

ggsave(fig4,filename = "./Figs/predicted_physio_param_infection_stages.png",units = "px", width = 3700, height = 3700)

# Table 3

sjPlot::tab_model(lmer_br,lmer_bt,lmer_bc,lmer_gr,
                  show.ci50 = T ,
                  show.stat = T,
                  string.stat = "t",
                  df.method = "kr",
                  dv.labels = c("Breathing rate","Body temperature","Δ Body condition","Growth rate"),
                  file = "./table_results/Table_results_lmer_physiological_parameters_p.val_kr.html")

```

# Parasitemia as explanatory variable

## Breathing rate

```{r mixed model breathing rate 2, warning=F, message=F, echo=F}

# Model 

lmer_br_para=lmer(data=data2016_2020, Breathing_rate~Infection_intensity+Infection_intensity:Treatment+days_resample+Age_in_days+Weight_g+Sex+Ambient_Temperature_AvgC+Year+(1|Nest))

# Predicted values for post-treament parasitemia 

mod_br_para=get_model_data(lmer_br_para,type='pred',terms="Infection_intensity") %>% 
   mutate(x=factor(c("0","1","2","3","4"), levels=c("0","1","2","3","4")))

# Table with sample sizes specific for breathing rate change data

m1=table(data2016_2020$Infection_intensity[!is.na(data2016_2020$Breathing_rate)])

mod_br_para <- mod_br_para %>% 
  mutate(x = factor(c(paste0(x,"\nn=",m1)), levels=c(paste0(x,"\nn=",m1))))
mod_br_para$lower_CI=c(31.11, mod_br_para$predicted[1]-2.96, mod_br_para$predicted[1]-6.49,mod_br_para$predicted[1]-4.67, mod_br_para$predicted[1]-4.63)
mod_br_para$higher_CI=c(41.42,mod_br_para$predicted[1]+3.90,mod_br_para$predicted[1]+1.75,mod_br_para$predicted[1]+1.46,mod_br_para$predicted[1]+4.45)
mod_br_para$se=c(2.61,1.74,2.09,1.56,2.31)

# Plotting predicted values across infection intensities

gg1_pred_para=ggplot(mod_br_para)+
  aes(as.factor(mod_br_para$x),mod_br_para$predicted)+
  geom_hline(yintercept = mean(mod_br_para$predicted, na.rm=T), linetype = "dashed")+
  labs(x="", y="Breathing rate")+
  geom_errorbar(aes(ymin=mod_br_para$lower_CI,ymax=mod_br_para$higher_CI),colour="black",size=2, width=.1)+
  geom_errorbar(aes(ymin=mod_br_para$predicted-mod_br_para$se,ymax=mod_br_para$predicted+mod_br_para$se),size=8,colour=wes_palette("Zissou1",5), width=0,)+
  geom_point(color ="black", outlier.shape = NA, size=4, width=.3)+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))+
  geom_segment(size = .8,
                 aes(x=1, y=max(mod_br_para$higher_CI, na.rm=T)+1.2, xend=5, yend=max(mod_br_para$higher_CI, na.rm=T)+1.2))+
    geom_text(aes(x=3, y=max(mod_br_para$higher_CI, na.rm=T)+2),
              label="n.s.", size = 5)
```

## Body temperature

```{r  mixed model body temperature 2, warning=FALSE, message=F, echo=F}

# Model 

lmer_bt_para=lmer(data= data2016_2020,body_temperature~Infection_intensity+Infection_intensity:Treatment+days_resample+Ambient_Temperature_AvgC+Age_in_days+Weight_g+Sex+Year+(1|Nest))

# Predicted values for post-treament parasitemia

mod_bt_para=get_model_data(lmer_bt_para,type='pred',terms="Infection_intensity") %>% 
   mutate(x=factor(c("0","1","2","3","4"), levels=c("0","1","2","3","4")))

# Table with sample sizes specific for body temperature change data

m2=table(data2016_2020$Infection_intensity[!is.na(data2016_2020$body_temperature)])

mod_bt_para <- mod_bt_para %>% 
  mutate(x = factor(c(paste0(x,"\nn=",m2)), levels=c(paste0(x,"\nn=",m2))))
mod_bt_para$lower_CI=c(39.40,mod_bt_para$predicted[1]-0.40,mod_bt_para$predicted[1]-0.60,mod_bt_para$predicted[1]-0.65,mod_bt_para$predicted[1]-1.38)
mod_bt_para$higher_CI=c(40.40,mod_bt_para$predicted[1]+0.55,mod_bt_para$predicted[1]+0.36,mod_bt_para$predicted[1]+0.19,mod_bt_para$predicted[1]+(-0.24))
mod_bt_para$se=c(0.23,0.24,0.24,0.21,0.29)

# Plotting predicted values across infection intensities

gg2_pred_para=ggplot(mod_bt_para)+
  aes(as.factor(mod_bt_para$x),mod_bt_para$predicted)+
  geom_hline(yintercept = mean(mod_bt_para$predicted, na.rm=T), linetype = "dashed")+
  geom_errorbar(aes(ymin=mod_bt_para$lower_CI,ymax=mod_bt_para$higher_CI),colour="black",size=2, width=.1)+
  geom_errorbar(aes(ymin=mod_bt_para$predicted-mod_bt_para$se,ymax=mod_bt_para$predicted+mod_bt_para$se),size=8,colour=wes_palette("Zissou1",5), width=0,)+
  labs(x="", y="Body temperature")+
  geom_point(color ="black", outlier.shape = NA, size=4, width=.3)+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))+
  geom_segment(size = .8,
                 aes(x=1, y=max(mod_bt_para$higher_CI, na.rm=T)+0.2, xend=5, yend=max(mod_bt_para$higher_CI, na.rm=T)+0.2))+
    geom_text(aes(x=3, y=max(mod_bt_para$higher_CI, na.rm=T)+0.25),
              label="**", size = 8)+
  geom_segment(size = .8,
                 aes(x=1, y=max(mod_bt_para$higher_CI, na.rm=T)+0.2, xend=1, yend=max(mod_bt_para$higher_CI, na.rm=T)+0.05))+
  geom_segment(size = .8,
                 aes(x=5, y=max(mod_bt_para$higher_CI, na.rm=T)+0.05, xend=5, yend=max(mod_bt_para$higher_CI, na.rm=T)+0.2))
```

## Body condition change

```{r mixed model body condition change 2, warning=FALSE, message=F, echo=F}

# Model 

lmer_bc_para=lmer(data= data2016_2020,delta_body_condition~Infection_intensity+Infection_intensity:Treatment+days_resample+Age_in_days+Sex+Year+(1|Nest))

# Predicted values for post-treament parasitemia

mod_bc_para=get_model_data(lmer_bc_para,type='pred',terms="Infection_intensity") %>% 
   mutate(x=factor(c("0","1","2","3","4"), levels=c("0","1","2","3","4")))

# Table with sample sizes specific for body condition change data

m3=table(data2016_2020$Infection_intensity[!is.na(data2016_2020$delta_body_condition)])

mod_bc_para <- mod_bc_para %>% 
  mutate(x = factor(c(paste0(x,"\nn=",m3)), levels=c(paste0(x,"\nn=",m3))))
mod_bc_para$lower_CI=c(-65.99,mod_bc_para$predicted[1]-5.71,mod_bc_para$predicted[1]-53.27,mod_bc_para$predicted[1]-37.05,mod_bc_para$predicted[1]-71.88)
mod_bc_para$higher_CI=c(25.59,mod_bc_para$predicted[1]+51.67,mod_bc_para$predicted[1]+16.43,mod_bc_para$predicted[1]+16.17,mod_bc_para$predicted[1]+4.09)
mod_bc_para$se=c(23.20,14.57,17.69,13.51,19.29)

# Plotting predicted values across infection intensities

gg3_pred_para=ggplot(mod_bc_para)+
  aes(as.factor(mod_bc_para$x),mod_bc_para$predicted)+
  geom_hline(yintercept = mean(mod_bc_para$predicted, na.rm=T), linetype = "dashed")+
  labs(x="", y="Δ Body condition")+
  geom_errorbar(aes(ymin=mod_bc_para$lower_CI,ymax=mod_bc_para$higher_CI),colour="black",size=2, width=.1)+
  geom_errorbar(aes(ymin=mod_bc_para$predicted-mod_bc_para$se,ymax=mod_bc_para$predicted+mod_bc_para$se),size=8,colour=wes_palette("Zissou1",5), width=0,)+
  geom_point(color ="black", outlier.shape = NA, size=4, width=.3)+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))+
  geom_segment(size = .8,
                 aes(x=1, y=-105, xend=5, yend=-105))+
    geom_text(aes(x=3, y=-110),
              label="p=0.08", size = 5)+
  geom_segment(size = .8,
                 aes(x=1, y=-105, xend=1, yend=-105+5))+
  geom_segment(size = .8,
                 aes(x=5, y=-105, xend=5, yend=-105+5))

```

## Growth rate

```{r mixed model growth rate 2, warning=FALSE, message=F, echo=F}

# Model 

lmer_gr_para=lmer(data= data2016_2020,Growth_rate~Infection_intensity+Infection_intensity:Treatment+days_resample+Sex+Age_in_days+Year+(1|Nest))

# Predicted values for post-treament parasitemia

mod_gr_para=get_model_data(lmer_gr_para,type='pred',terms="Infection_intensity") %>% 
   mutate(x=factor(c("0","1","2","3","4"), levels=c("0","1","2","3","4")))

# Table with sample sizes specific for growth rate data

m4=table(data2016_2020$Infection_intensity[!is.na(data2016_2020$Growth_rate)])

mod_gr_para <- mod_gr_para %>% 
  mutate(x = factor(c(paste0(x,"\nn=",m4)), levels=c(paste0(x,"\nn=",m4))))
mod_gr_para$lower_CI=c(11.44,mod_gr_para$predicted[1]-2.22,mod_gr_para$predicted[1]-10.47,mod_gr_para$predicted[1]-6.60,mod_gr_para$predicted[1]-11.39)
mod_gr_para$higher_CI=c(25.14,mod_gr_para$predicted[1]+7.08,mod_gr_para$predicted[1]+0.92,mod_gr_para$predicted[1]+1.91,mod_gr_para$predicted[1]+0.89)
mod_gr_para$se=c(3.47,2.36,2.89,2.16,3.12)

# Plotting predicted values across infection intensities

gg4_pred_para=ggplot(mod_gr_para)+
  aes(as.factor(mod_gr_para$x),mod_gr_para$predicted)+
  geom_hline(yintercept = mean(mod_gr_para$predicted, na.rm=T), linetype = "dashed")+
  labs(x="", y="Growth rate")+
  geom_errorbar(aes(ymin=mod_gr_para$lower_CI,ymax=mod_gr_para$higher_CI),colour="black",size=2, width=.1)+
  geom_errorbar(aes(ymin=mod_gr_para$predicted-mod_gr_para$se,ymax=mod_gr_para$predicted+mod_gr_para$se),size=8,colour=wes_palette("Zissou1",5), width=0,)+
  geom_point(color ="black", outlier.shape = NA, size=4, width=.3)+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))+
  geom_segment(size = .8,
                 aes(x=1, y=5, xend=5, yend=5))+
    geom_text(aes(x=3, y=5-0.63),
              label="p=0.09", size = 5)+
  geom_segment(size = .8,
                 aes(x=1, y=5, xend=1, yend=5+0.5))+
  geom_segment(size = .8,
                 aes(x=5, y=5, xend=5, yend=5+0.5))

```

# Summary four models

```{r summary}

# Figure 5

fig5=gg1_pred_para+gg2_pred_para+gg3_pred_para+gg4_pred_para + plot_annotation(tag_levels = 'A')& 
  theme(plot.tag = element_text(size = 16, face = "bold"))

ggsave(fig5,filename = "./Figs/predicted_physio_param_infection_intensities.png",units = "px", width = 3700, height = 3700)

# Table 4 

sjPlot::tab_model(lmer_br_para,lmer_bt_para,lmer_bc_para,lmer_gr_para,
                  show.ci50 = T ,
                  show.se = T,
                  show.stat = T,
                  string.stat = "t",
                  p.val = "kr",
                  dv.labels = c("Breathing rate","Body temperature","\U0394 Body condition","Growth rate"),
                  file = "./table_results/table_results_parasitemia_lmer_physiological_parameters_p.val_kr.html")

```

# Host health to parasitemia 

```{r, warning=F,message=F}

tol_resdata=data2016_2020

tol_resdata$Infection_intensity=as.numeric(tol_resdata$Infection_intensity)
tol_resdata$Diff_Inf_Class=factor(tol_resdata$Diff_Inf_Class, levels=c("Increase","Peak","Decrease"))

# Second sampling parasitemia

## linear model testing effect of infection intensity at second sampling on body condition change

tolres_mod=lm(delta_body_condition~Infection_intensity, data=tol_resdata)

summary(tolres_mod)

## Testing the interaction between infection stages and infection intensities

## with delta body condition

tolres_deltamod=lm(delta_body_condition~Infection_intensity*Diff_Inf_Class, data=tol_resdata)

## comparison of slopes among infection stages 

lms_delta=lstrends(tolres_deltamod,~Diff_Inf_Class:Infection_intensity, var="Infection_intensity")

contrast(lms_delta,"pairwise")

tolre_deltasum=summary(lms_delta)

## comparison of slopes to zero

summary(lms_delta, infer=T)

# Plotting body condition change - second infection intensity

tolres=ggplot(data =data2016_2020[! data2016_2020$Infection_intensity %in% c(NA,0) & ! data2016_2020$Diff_Inf_Class %in% NA,], aes(y=delta_body_condition,x=as.numeric(Infection_intensity),col=Diff_Inf_Class))+
    geom_jitter(size=3, alpha=0.5)+
    geom_smooth(alpha=0.2, size=1.5, method='lm',se = T)+
    labs(y="Body condition change",x="Parasitemia \n at second sampling", col='Infection stages')+
    scale_x_continuous(breaks=seq(2,5,1),labels=c("1","2","3","4"))+
    scale_color_manual(labels = c("Increasing", "Peak", "Decreasing"),values = c("#3B9AB2", "#E1AF00", "#F21A00"))+
    theme_classic()+
    theme(legend.text = element_text(size=19),legend.title = element_text(size=22), axis.text = element_text(size=16), axis.title = element_text(size=18))

# Figure 3

fig3=tolres + 
  theme(plot.tag = element_text(size = 16, face = "bold"))

ggsave(fig3,filename = "./Figs/delta_body_condition_to_parasitemia_second.png",units = "px", width = 3700, height = 2800)
```

# Supplementary figures

```{r}

# Plotting observed values across infection stages

gg1=ggplot(data2016_2020[!data2016_2020$Diff_Inf_Class %in% NA,])+
  aes(Diff_Inf_Class,Breathing_rate)+
  geom_hline(yintercept = mean(data2016_2020$Breathing_rate, na.rm=T), linetype = "dashed")+
  labs(x="", y="Breathing rate")+
  geom_jitter(color ="lightgrey", size=2, width=.3)+
  stat_summary(fun=mean, colour="cornflowerblue", geom="errorbar", 
               size=2.8 , width=0.05, show.legend = FALSE, 
               fun.max = function(x) mean(x) + sd(x),
               fun.min = function(x) mean(x) - sd(x))+
  stat_summary(fun=mean, colour="black", geom="point", 
               size=5 ,show.legend = FALSE)+
  stat_n_text()+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))

gg2=ggplot(data2016_2020[!data2016_2020$Diff_Inf_Class %in% NA,])+
  aes(Diff_Inf_Class,body_temperature)+
  geom_hline(yintercept = mean(data2016_2020$body_temperature, na.rm=T), linetype = "dashed")+
  labs(x="", y="Body temperature")+
  geom_jitter(color ="lightgrey", size=2, width=.3)+
  stat_summary(fun=mean, colour="cornflowerblue", geom="errorbar", 
               size=2.8 , width=0.05, show.legend = FALSE, 
               fun.max = function(x) mean(x) + sd(x),
               fun.min = function(x) mean(x) - sd(x))+
  stat_summary(fun=mean, colour="black", geom="point", 
               size=5 ,show.legend = FALSE)+
  stat_n_text()+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))

gg3=ggplot(data2016_2020[!data2016_2020$Diff_Inf_Class %in% NA,])+
  aes(Diff_Inf_Class,delta_body_condition)+
  geom_hline(yintercept = mean(data2016_2020$delta_body_condition, na.rm=T), linetype = "dashed")+
  labs(x="", y="\U0394 Body condition")+
  geom_jitter(color ="lightgrey", size=2, width=.3)+
  stat_summary(fun=mean, colour="cornflowerblue", geom="errorbar", 
               size=2.8 , width=0.05, show.legend = FALSE, 
               fun.max = function(x) mean(x) + sd(x),
               fun.min = function(x) mean(x) - sd(x))+
  stat_summary(fun=mean, colour="black", geom="point", 
               size=5 ,show.legend = FALSE)+
  stat_n_text()+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))

gg4=ggplot(data2016_2020[!data2016_2020$Diff_Inf_Class %in% NA,])+
  aes(Diff_Inf_Class,Growth_rate)+
  geom_hline(yintercept = mean(data2016_2020$Growth_rate, na.rm=T), linetype = "dashed")+
  labs(x="", y="Growth rate")+
  geom_jitter(color ="lightgrey", size=2, width=.3)+
  stat_summary(fun=mean, colour="cornflowerblue", geom="errorbar", 
               size=2.8 , width=0.05, show.legend = FALSE, 
               fun.max = function(x) mean(x) + sd(x),
               fun.min = function(x) mean(x) - sd(x))+
  stat_summary(fun=mean, colour="black", geom="point", 
               size=5 ,show.legend = FALSE)+
  stat_n_text()+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))

# Figure S1

figs1=gg1+gg2+gg3+gg4 + plot_annotation(tag_levels = 'A')& 
  theme(plot.tag = element_text(size = 16, face = "bold"))

ggsave(figs1,filename = "./Figs/observed_physio_param_infection_stages.png",units = "px", width = 3500, height = 3800)

# Plotting observed values across infection intensities

gg5=ggplot(data2016_2020[!data2016_2020$Infection_intensity %in% NA,])+
  aes(Infection_intensity,Breathing_rate)+
  geom_hline(yintercept = mean(data2016_2020$Breathing_rate, na.rm=T), linetype = "dashed")+
  labs(x="", y="Breathing rate")+
  geom_jitter(color ="lightgrey", size=2, width=.3)+
  stat_summary(fun=mean, colour="cornflowerblue", geom="errorbar", 
               size=2.8 , width=0.05, show.legend = FALSE, 
               fun.max = function(x) mean(x) + sd(x),
               fun.min = function(x) mean(x) - sd(x))+
  stat_summary(fun=mean, colour="black", geom="point", 
               size=5 ,show.legend = FALSE)+
  stat_n_text()+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))

gg6=ggplot(data2016_2020[!data2016_2020$Infection_intensity %in% NA,])+
  aes(Infection_intensity,body_temperature)+
  geom_hline(yintercept = mean(data2016_2020$body_temperature, na.rm=T), linetype = "dashed")+
  labs(x="", y="Body temperature")+
  geom_jitter(color ="lightgrey", size=2, width=.3)+
  stat_summary(fun=mean, colour="cornflowerblue", geom="errorbar", 
               size=2.8 , width=0.05, show.legend = FALSE, 
               fun.max = function(x) mean(x) + sd(x),
               fun.min = function(x) mean(x) - sd(x))+
  stat_summary(fun=mean, colour="black", geom="point", 
               size=5 ,show.legend = FALSE)+
  stat_n_text()+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))

gg7=ggplot(data2016_2020[!data2016_2020$Infection_intensity %in% NA,])+
  aes(Infection_intensity,delta_body_condition)+
  geom_hline(yintercept = mean(data2016_2020$delta_body_condition, na.rm=T), linetype = "dashed")+
  labs(x="", y="\U0394 Body condition")+
  geom_jitter(color ="lightgrey", size=2, width=.3)+
  stat_summary(fun=mean, colour="cornflowerblue", geom="errorbar", 
               size=2.8 , width=0.05, show.legend = FALSE, 
               fun.max = function(x) mean(x) + sd(x),
               fun.min = function(x) mean(x) - sd(x))+
  stat_summary(fun=mean, colour="black", geom="point", 
               size=5 ,show.legend = FALSE)+
  stat_n_text()+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))

gg8=ggplot(data2016_2020[!data2016_2020$Infection_intensity %in% NA,])+
  aes(Infection_intensity,Growth_rate)+
  geom_hline(yintercept = mean(data2016_2020$Growth_rate, na.rm=T), linetype = "dashed")+
  labs(x="", y="Growth rate")+
  geom_jitter(color ="lightgrey", size=2, width=.3)+
  stat_summary(fun=mean, colour="cornflowerblue", geom="errorbar", 
               size=2.8 , width=0.05, show.legend = FALSE, 
               fun.max = function(x) mean(x) + sd(x),
               fun.min = function(x) mean(x) - sd(x))+
  stat_summary(fun=mean, colour="black", geom="point", 
               size=5 ,show.legend = FALSE)+
  stat_n_text()+
  theme_classic()+
  theme(legend.position="none", axis.title=element_text(size=14),  axis.text=element_text(size=12), axis.line.x = element_blank(), axis.ticks.x = element_blank(), plot.margin = margin(0, 0, 0, 0, "cm"), plot.title = element_text(hjust = 0.5, face="bold"))

# Figure S2

figs2=gg5+gg6+gg7+gg8 + plot_annotation(tag_levels = 'A')& 
  theme(plot.tag = element_text(size = 16, face = "bold"))

ggsave(figs2,filename = "./Figs/observed_physio_param_parasitemia.png",units = "px", width = 3500, height = 3800)

# Plotting effect sizes of 'infection stages' models

pm1=plot_model(lmer_br,
               sort.est = T,
               se = T,
               title = "Breathing rate",
               axis.labels = rev(c("Increase : Treatment [Malarone]","Age (days)","Peak : Treatment [Malarone]","Decrease : Treatment [Malarone]","Uninfected : Treatment [Malarone]","Increasing parasitemia","Sex [Males]","Decreasing parasitemia","Sampling interval","Peak parasitemia","Weight (g)","Ambient temperature","Year [2019]","Year [2018]","Year [2020]")))

pm2=plot_model(lmer_bt,
               sort.est = T,
               se = T,
               title = "Body temperature",
               axis.labels = rev(c("Peak : Treatment [Malarone]","Ambient temperature","Year [2020]","Age (days)","Decrease : Treatment [Malarone]","Weight (g)","Sex [Males]",
"Decreasing parasitemia","Increase : Treatment [Malarone]","Increasing parasitemia","Uninfected : Treatment [Malarone]",
"Peak parasitemia","Sampling interval")))

pm3=plot_model(lmer_bc,
               sort.est = T,
               se = T,
               title = "Δ Body condition",
               axis.labels = rev(c("Year [2020]","Peak : Treatment [Malarone]","Year [2018]","Year [2019]","Sampling interval","Increase : Treatment [Malarone]","Decrease : Treatment [Malarone]","Age (days)", "Uninfected : Treatment [Malarone]","Sex [Males]","Increasing parasitemia","Decreasing parasitemia","Peak parasitemia")))

pm4=plot_model(lmer_gr,
               sort.est = T,
               se = T,
               title = "Growth rate", 
               axis.labels = rev(c("Peak : Treatment [Malarone]","Year [2020]","Year [2018]","Sampling interval","Year [2019]","Decrease : Treatment [Malarone]","Increase : Treatment [Malarone]","Uninfected : Treatment [Malarone]","Increasing parasitemia","Decreasing parasitemia","Peak parasitemia","Sex [Males]","Age (days)")))

# Figure S3

figs3=pm1+pm2+pm3+pm4 + plot_annotation(tag_levels = 'A')& 
  theme(plot.tag = element_text(size = 16, face = "bold"))

ggsave(figs3,filename = "./Figs/effect_sizes_param_stages.png",units = "px", width = 3500, height = 3800)

# Plotting effect sizes of 'infection intensities' models

pm5=plot_model(lmer_br_para,
               sort.est = T,
               se = T,
               title = "Breathing rate",
               axis.labels = rev(c("Infection intensity [2] : Treatment [Malarone]","Age (days)","Infection intensity 1", "Infection intensity 4", "Infection intensity [1] : Treatment [Malarone]","Infection intensity [3] : Treatment [Malarone]", "Infection intensity [0] : Treatment [Malarone]","Sex [Males]","Infection intensity 3","Sampling interval","Infection intensity 2","Weight (g)","Ambient temperature","Year [2019]","Year [2018]","Year [2020]")))

pm6=plot_model(lmer_bt_para,
               sort.est = T,
               se = T,
               title = "Body temperature",
               axis.labels = rev(c("Ambient temperature","Year [2020]","Age (days)", "Infection intensity [3] : Treatment [Malarone]","Infection intensity 1", "Infection intensity [2] : Treatment [Malarone]","Weight (g)","Infection intensity 2","Sex [Males]","Infection intensity [0] : Treatment [Malarone]","Infection intensity [1] : Treatment [Malarone]","Infection intensity 3", "Sampling interval","Infection intensity 4")))

pm7=plot_model(lmer_bc_para,
               sort.est = T,
               se = T,
               title = "Δ Body condition",
               axis.labels = rev(c("Year [2020]","Year [2018]","Year [2019]","Infection intensity [2] : Treatment [Malarone]","Infection intensity 1","Sampling interval","Infection intensity [3] : Treatment [Malarone]","Infection intensity [0] : Treatment [Malarone]","Age (days)","Sex [Males]","Infection intensity 3","Infection intensity 2","Infection intensity [1] : Treatment [Malarone]","Infection intensity 4")))

pm8=plot_model(lmer_gr_para,
               sort.est = T,
               se = T,
               title = "Growth rate", 
               axis.labels = rev(c("Year [2020]","Infection intensity [2] : Treatment [Malarone]","Year [2018]","Year [2019]","Sampling interval","Infection intensity 1","Infection intensity [3] : Treatment [Malarone]","Infection intensity [0] : Treatment [Malarone]","Infection intensity 3","Sex [Males]","Infection intensity 2","Age (days)","Infection intensity 4","Infection intensity [1] : Treatment [Malarone]")))

# Figure S4

figs4=pm5+pm6+pm7+pm8 + plot_annotation(tag_levels = 'A')& 
  theme(plot.tag = element_text(size = 16, face = "bold"))

ggsave(figs4,filename = "./Figs/effect_sizes_param_intensities.png",units = "px", width = 3500, height = 3800)

```

